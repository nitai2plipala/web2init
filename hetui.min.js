(function(){console.log("如出现纰漏， 请发邮件或微信, 联系管理员修复bug。。。");console.log("微信：hobo2plipala");console.log("微信：hetui2plipala")console.log("Email: hebo.plipala@gmail.com");console.log("Email: hetui2plipala@gmail.com")}());String.prototype.TrimSpace=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.Int=function(){return parseInt(this)};Event.prototype.Bubble=function(boolean){if(boolean){}else{if(this.stopPropagation)this.stopPropagation();if(this.preventDefault)this.preventDefault();this.cancelBubble=true;this.returnValue=false}};Array.IsArray=function(array){if(this.isArray){return this.isArray(array)}else{return Object.prototype.toString.call(array)=="[object Array]"}};Object.prototype.Foreach=function(functor,self){self=self||this;for(var key in self){var proto=Object.prototype.hasOwnProperty.call(self,key);functor.call(self,key,self[key],proto)}};if(Object.prototype.Foreach){Object.defineProperty(Object.prototype,'Foreach',{enumerable:false})}Document.prototype.QueryNode=function(pattern){};Document.prototype.QueryElement=function(pattern){return document.documentElement.QueryElement(pattern)};Document.prototype.QueryComment=function(pattern){};Document.prototype.QueryTextNode=function(pattern){};Element.prototype.TagName=function(){var tagName=this.tagName.toLowerCase();tagName=tagName.charAt(0).toUpperCase()+tagName.slice(1);return tagName};Element.prototype.QueryNode=function(pattern){};Element.prototype.QueryElement=function(pattern){var elements;var htmNodeTuple;if(typeof pattern==="string"){var isSingleSelector=pattern.indexOf(' ')===-1&&pattern.indexOf('>')===-1&&pattern.indexOf('+')===-1&&pattern.indexOf('~')===-1;if(isSingleSelector){if(pattern.charAt(0)==='#'){if(this===document.documentElement){var element=document.getElementById(pattern.substring(1))}else{var element=this.querySelectorAll(pattern)}if(element){elements=[element]}else{elements=[]}}else if(pattern.charAt(0)==='.'){elements=this.getElementsByClassName?this.getElementsByClassName(pattern.substring(1)):this.querySelectorAll?this.querySelectorAll(pattern):[]}else if(pattern.charAt(0)==='['&&pattern.charAt(pattern.length-1)===']'){var attrSelector=pattern.substring(1,pattern.length-1);var allElements=this.getElementsByTagName('*');elements=[];for(var i=0;i<allElements.length;i++){if(allElements[i].hasAttribute&&allElements[i].hasAttribute(attrSelector)){elements.push(allElements[i])}}}else{elements=this.getElementsByTagName(pattern)}htmNodeTuple=new HtmNodeTuple(elements);return htmNodeTuple}else{if(this.querySelectorAll){elements=this.querySelectorAll(pattern);htmNodeTuple=new HtmNodeTuple(elements);return htmNodeTuple}else{console.warn("querySelectorAll is not supported in this browser");return new HtmNodeTuple([])}}}else if(Array.IsArray(pattern)){console.log("数组模式选择器");return new HtmNodeTuple([])}else{console.warn("Unsupported pattern type for QueryElement");return new HtmNodeTuple([])}};Element.prototype.QueryComment=function(pattern){};function Module(){}Module.Audio=function(){Module.Audio.prototype.Play=function(){this.core.play();this.Attr.paused=this.core.paused};Module.Audio.prototype.Stop=function(){this.core.pause();this.Attr.paused=this.core.paused};Module.Audio.prototype.Pause=function(boolean){if(!boolean){this.core.play();this.Attr.paused=this.core.paused}else{this.core.pause();this.Attr.paused=this.core.paused}};Module.Audio.prototype.Muted=function(boolean){this.core.muted=boolean;this.Attr.muted=boolean};Module.Audio.prototype.Volume=function(volume){this.core.volume=volume;this.Attr.volume=volume};Module.Audio.prototype.Time=function(time){this.core.currentTime=time;this.Attr.time=time};Module.Audio.prototype.TimeUpdate=function(functor){var self=this;this.core["ontimeupdate"]=function(event){self.Attr.time=this.currentTime;if(self.Attr.Time==self.Attr.Duration){this.paused=true;self.Attr.paused=true}functor(event)}};var core=document.createElement("audio");this.core=core;this.Attr={paused:true,muted:false,volume:1.0,duration:NaN,time:0};var self=this;core["ondurationchange"]=function(){self.Attr.duration=this.duration;self.Attr.time=this.currentTime};core["ontimeupdate"]=function(){self.Attr.time=this.currentTime;if(self.Attr.Time==self.Attr.Duration){this.paused=true;self.Attr.paused=true}};this.Attr.paused=core.paused;this.Attr.muted=core.muted;this.Attr.volume=core.volume};function Attribute(){}Attribute.Exist=function(node,attrname){if(node.hasAttribute){return node.hasAttribute(attrname)}};Attribute.Remove=function(node,attrname){if(node.removeAttribute){return node.removeAttribute(attrname)}};Attribute.Update=function(node,attrname,value){if(node.setAttribute){return node.setAttribute(attrname,value)}};Attribute.Query=function(node,attrname){if(node.getAttribute){return node.getAttribute(attrname)}};function HtmNodeType(){};HtmNodeType.Document=0;HtmNodeType.DocType=1;HtmNodeType.Element=2;HtmNodeType.Comment=3;HtmNodeType.TextNode=4;HtmNodeType.HetuiNode=5;HtmNodeType.ErrorNode=6;function Environment(){};function Tuple(array){Tuple.prototype.Push=function(value){if(this.push){this.push(value)}else{}};Tuple.prototype.Concat=function(tuple){if(this.concat){this.concat(tuple)}else{console.info("Tuple Concat Not Define");for(var i=0;i<tuple.length;i++){this[i]=tuple[i]}}};Tuple.prototype.Foreach=function(functor,self){if(this.forEach){self=self||this;this.forEach(functor,self)}else{}};Tuple.prototype.__proto__=Array.prototype;var self=new Array();self.__proto__=Tuple.prototype;if(array){self.tuple=array;for(var i=0;i<array.length;i++){self[i]=array[i]}}else{self.tuple=new Array}return self};function HtmNodeTuple(tuple){HtmNodeTuple.prototype.Size=function(){return this.tuple.length};HtmNodeTuple.prototype.HtmNode=function(){for(var i=0;i<this.length;i++){this[i]=new HtmNode(this[i])}};HtmNodeTuple.prototype.__proto__=Tuple.prototype;var self=new Tuple(tuple);self.__proto__=HtmNodeTuple.prototype;return self}function Signal(){}function Cookie(){}function Class(){}Class.Functor=function(){};Class.Functor.Param=function(functor){if(typeof functor=='function'){var param=/[^(]+\(([^)]*)?\)/gm.exec(Function.prototype.toString.call(functor));if(param[1]){return param[1].replace(/[^,\w]*/g,'').split(',')}}};Class.Property=function(obj){var property=new Array;for(var name in obj){if(Object.prototype.hasOwnProperty.call(obj,name)){property.push(name)}}return property};function HtmNode(node){if(typeof node=="string"){}else{switch(node.nodeType){case Document.DOCUMENT_TYPE_NODE:case 10:this.Type=HtmNodeType.DocType;this.Node=node;break;case Document.ELEMENT_NODE:case 1:this.Type=HtmNodeType.Element;this.TagName=node.TagName();this.Node=node;this.Attribute=new Tuple();for(var i=0;i<node.attributes.length;i++){this.Attribute.Push({name:node.attributes[i].name,value:node.attributes[i].value})}break;case Document.TEXT_NODE:case 3:this.Type=HtmNodeType.TextNode;this.Data=node.data;this.Node=node;break;case Document.COMMENT_NODE:case 8:this.Type=HtmNodeType.Comment;this.Data=node.data;this.Node=node;break;case Document.DOCUMENT_NODE:case 9:this.Type=HtmNodeType.Document;this.Node=node;break;default:throw node}}};HtmNode.Children=function(node){var tuple=node.childNodes;return HtmNodeTuple(tuple)};HtmNode.ChildNode=function(node){};HtmNode.ChildElement=function(node){};HtmNode.ChildTextNode=function(node){};HtmNode.ChildComment=function(node){};function Observer(){Observer.prototype.publish=function(subject,observer){var object=this.Subject;var emitEvent=function(object){for(var key in object){if(Object.prototype.hasOwnProperty.call(object,key)){if("@Observer::signal"==key){object[key].forEach(function(signal){signal.Functor.apply(observer,signal.Param.tuple)})}else{emitEvent(object[key])}}}};for(var i=0;i<subject.length;i++){var objkey=subject[i];if(subject.length==i+1){if(object){object=object[objkey];emitEvent(object)}}else{object=object[objkey]}if(!object)return}};Observer.prototype.subscribe=function(subject,signal){var object=this.Subject;for(var i=0;i<subject.length;i++){var objkey=subject[i];if(subject.length==i+1){if(object[objkey]){object=object[objkey];if(!object["@Observer::signal"]){object["@Observer::signal"]=new Array}}else{object[objkey]={};object=object[objkey];object["@Observer::signal"]=new Array}object["@Observer::signal"].push(signal)}else{if(object[objkey]){object=object[objkey]}else{object[objkey]={};object=object[objkey]}}}};Observer.prototype.withdraw=function(subject,signal){};this.Source=Tuple();this.Listener=Tuple();this.Subject={}}Observer.Proxy=function(){};Observer.Timer=function(){};Observer.Define=function(value){var observe=function(object,field,observer){var objkey=field[field.length-1];Object.defineProperty(this,objkey,{get:function(){return value},set:function(newvalue){var subject=field;if(value&&typeof value==="object"&&newvalue&&typeof newvalue==="object"){let oldDescriptors=Object.getOwnPropertyDescriptors(value);for(let key of Object.keys(oldDescriptors)){let desc=oldDescriptors[key];if(desc.get||desc.set){Object.defineProperty(newvalue,key,desc)}}}value=newvalue;observer.publish(subject,object)}});return value};observe["@Hetui::observer"]="存取器";if(typeof value=="object"&&value){Object.keys(value).forEach(key=>{if(typeof value[key]=="function"&&value[key]["@Hetui::observer"]){observe[key]=value[key]}})}return observe};Observer.Embed=function(){};Observer.Watch=function(){};function Network(){}Network.Form=function(config){config=config||{};var option=config["option"]||{};var method=config['method'].toUpperCase()||"POST";var target=config['target']||"_self";var url=config.url;var turnForm=document.createElement("form");document.body.appendChild(turnForm);turnForm.method=method;delete config['method'];turnForm.target=target;delete config['target'];turnForm.action=url;delete config['url'];for(var item in config['data']){var newElement=document.createElement("input");newElement.setAttribute("type","hidden");newElement.setAttribute("name",item);newElement.setAttribute("value",config['data'][item]);turnForm.appendChild(newElement)}turnForm.submit()};Network.Form.Encoded=function(option,url){option=option||{};var data="";option.Foreach(function(key,value,proto){if(proto){data=data+"&"+key+"="+value}});data=data.substring(1);switch(url){case undefined:return data;case"":return"?"+data;default:return url+"?"+data}};Network.XHR=function(config){config=config||{};config.data=config.data||{};var method=config.method.toUpperCase()||"GET";var async=config.async||true;var header=config["header"]||{};var option=config["option"]||{};var code=config.code||"form";var xhr;try{xhr=new XMLHttpRequest()}catch(e){try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){alert("哪来的老古董浏览器，我见了都得叫声叔！！！");return false}}}xhr["onreadystatechange"]=function(){switch(xhr.readyState){case 4:{if(xhr.status>=200&&xhr.status<300||xhr.status==304){var response;switch(option["responseType"]){case"string":response=xhr.responseText;option["success"](response);break;case"json":response=xhr.response;option["success"](response);break;case"blob":response=xhr.response;option["success"](response,URL.createObjectURL(response));break case"html":response=new DOMParser();response=response.parseFromString(xhr.responseText,"text/html");response=response.firstChild;option["success"](response);break;case"xml":{console.log("not set xml parser")}case"stream":{console.log("not set stream parser")}case"socket":{console.log("not set socket parser")}default:console.log("not know this  parser");option["success"](response)}}else{console.error(xhr.status,xhr.responseText)}break}default:}};var url=config.url;xhr.responseType=option.responseType||"";xhr.open(method,url,async,option.username,option.password);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");var data="";switch(code){case"form":{config.data.Foreach(function(key,value,proto){if(proto){data=data+"&"+key+"="+value}});data=data.substring(1);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");break}case"json":{xhr.setRequestHeader("Content-Type","application/json");data=JSON.stringify(config.data);break}default:console.log("error catch coded")}header.Foreach(function(key,value,proto){if(proto){if(key.toLowerCase()=="cookie"){var cookie;header[key].Foreach(function(key,value,proto){if(proto){cookie=cookie+key+"="+value+";"}});header[key]=cookie}xhr.setRequestHeader(key,value)}});xhr.send(data)};Network.JsonP=function(link,option){var name=option.name;var value=option.value;link.data[name]=value;window[name]=function(reponse){switch(option.type){}option["functor"](reponse);delete window[name]};var url=Network.Form.Encoded(link.data,link.url);var script=document.createElement("script");script.type="text/javascript";script.src=url;document.head.appendChild(script);document.head.removeChild(script)};function Hetui(){Hetui.prototype.version="0.1.24";this["@Hetui::observer"]=new Observer()}Hetui.Observe=function(object){var hetui=new Hetui();var observer=hetui["@Hetui::observer"];var watcher=function(context,field){for(var objkey in context){if(Object.prototype.hasOwnProperty.call(context,objkey)){var observe=context[objkey];field.push(objkey);if(typeof observe=="function"&&observe["@Hetui::observer"]){observe.call(context,object,field,observer);Object.keys(observe).forEach(key=>{if(key!="@Hetui::observer"){var value=field[field.length-1];watcher(context[value],field)}});field.pop()}else if(typeof observe=="object"){watcher(observe,field);field=[]}else{field.pop()}}}};watcher(object,[]);observer=object;hetui.Run(observer);return observer};Hetui.Directive=function(tuple){};Hetui.fmt2={date:function(input,format="YYYY-MM-DD HH:mm:ss"){let date;if(input instanceof Date){date=input}else if(typeof input==="number"){date=input>1e12?new Date(input):new Date(input*1000)}else{throw new Error("Invalid date input");}const Y=date.getFullYear();const M=String(date.getMonth()+1).padStart(2,"0");const D=String(date.getDate()).padStart(2,"0");const H=String(date.getHours()).padStart(2,"0");const m=String(date.getMinutes()).padStart(2,"0");const s=String(date.getSeconds()).padStart(2,"0");const result=format.replace("YYYY",Y).replace("MM",M).replace("DD",D).replace("HH",H).replace("mm",m).replace("ss",s);return result},vtime:function(seconds){seconds=Math.floor(Number(seconds)||0);let h=0,m=0,s=0;if(seconds<6*60){s=seconds;return s+"秒"}else if(seconds<2*3600){m=Math.floor(seconds/60);s=seconds%60;return m+"分"+s+"秒"}else{h=Math.floor(seconds/3600);m=Math.floor((seconds%3600)/60);s=seconds%60;return h+"小时"+m+"分"+s+"秒"}}}Hetui.prototype.Run=function(observer){var hetui=this,watcher=hetui["@Hetui::observer"];var htm=new HtmNode(document);var zhentu={range:new Array(3),field:[],subject:[],};var NodeDFS=function(htm){switch(htm.Type){case HtmNodeType.TextNode:htm.Data=htm.Data.TrimSpace();if(htm.Data){var mode=new RegExp("\\[\\[-[^\\[\\[]*?\\]\\]","g");var template=htm.Data.match(mode);while(template){console.log(template);template=null}}break;case HtmNodeType.Element:if(Attribute.Exist(htm.Node,"HeTui")){htm["signal"]={};htm.Attribute.Foreach(function(attribute){var signal=htm["signal"];switch(attribute.name){case"hetui":if(attribute.value){signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);signal.Functor.apply(hetui,argument)}break;case"@upmouse":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onmouseup"]=function(event){var signal=htm["signal"]["@upmouse"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@downmouse":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onmousedown"]=function(event){var signal=htm["signal"]["@downmouse"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@keydown":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onkeydown"]=function(event){var signal=htm["signal"]["@keydown"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@movemouse":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onmousemove"]=function(event){var signal=htm["signal"]["@movemouse"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@entermouse":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onmouseenter"]=function(event){var signal=htm["signal"]["@entermouse"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@touchstart":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["ontouchstart"]=function(event){var signal=htm["signal"]["@touchstart"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@touchstart:":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node.addEventListener("touchstart",function(event){var signal=htm["signal"]["@touchstart:"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)});break;case"@touchmove":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["ontouchmove"]=function(event){var signal=htm["signal"]["@touchmove"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@touchmove:":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node.addEventListener("touchmove",function(event){var signal=htm["signal"]["@touchmove:"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)});break;case"@touchend":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["ontouchend"]=function(event){var signal=htm["signal"]["@touchend"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@touchenter":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["ontouchenter"]=function(event){var signal=htm["signal"]["@touchenter"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@touchleave":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["ontouchleave"]=function(event){var signal=htm["signal"]["@touchleave"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@click":signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onclick"]=function(event){var signal=htm["signal"]["@click"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@click:":break;case"@click|functor":var funcbody=attribute.value.split("=>");if(funcbody.length<2){throw"Framework Hetui @click|functor use '=>' symbol"}var argument=funcbody[0].split(",");signal[attribute.name]={Name:attribute.value,Param:new Tuple(argument),Functor:undefined,};signal=signal[attribute.name];signal.Param.Foreach(function(value,index){this[index]=value.TrimSpace()});argument.push(funcbody.slice(1).join("=>"));signal.Functor=Function.apply(this,argument);htm.Node["onclick"]=function(event){var signal=htm["signal"]["@click|functor"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)};break;case"@submit":if(htm.TagName=="Form"){signal[attribute.name]={Name:attribute.value,Param:undefined,Functor:Hetui,};signal=signal[attribute.name];attribute.value.split(":").forEach(function(value){this.Functor=this.Functor[value]},signal);signal.Param=new Tuple(Class.Functor.Param(signal.Functor));htm.Node["onsubmit"]=function(event){var signal=htm["signal"]["@submit"];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"event":this[index]=event;break;case"form":var name,form={};for(var n=0;n<htm.Node.length;n++){name=htm.Node[n].name;if(name){form[name]=htm.Node[n].value}};this[index]=form;break;case"htm":this[index]=htm;break;case"observer":this[index]=observer;default:}},argument);return signal.Functor.apply(hetui,argument)}}else{throw"Framework Hetui @submit bind 'Form' element."}break;case":attr":var field=attribute.value.split("|");var attr=field[0].TrimSpace();if(field.length>2){throw"Framework Hetui :attr namespace more than threshold."}field=field.slice(1).join("|").split(":");var subject=field;signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","attr","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"attr":this[index]=attr;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,attr,field){var value=this;for(var i=0;i<field.length;i++){value=value[field[i]]}Attribute.Update(htm.Node,attr,value)};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,attr,field);break;case":attr|href":var field=attribute.value.split(":");var subject=field;if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject;var scope=zhentu.field.slice()}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){if(!value)return;switch(field[i]){case"#index":value=scope[0]+1;break;default:value=value[field[i]]}}htm.Node.href=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":attr|href|functor":var field=attribute.value.split("|");var subject=field[1].TrimSpace().split(":");field=field[0].TrimSpace().split(":");var functor=Hetui;subject.forEach(function(value,index){functor=functor[value]});subject=field;if(zhentu.range[0]){field=zhentu.field;subject=zhentu.subject;var scope=zhentu.field.slice()};signal[attribute.name]={Name:attribute.value,Param:new Tuple(Class.Functor.Param(functor)),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;case"observer":this[index]=observer;default:}},argument);signal.Functor=function(field){var value=functor.apply(htm,signal.Param.tuple);htm.Node.href=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":attr|src":var field=attribute.value.split(":");var subject=field;if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject;var scope=zhentu.field.slice()}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){if(!value)return;switch(field[i]){case"#index":value=scope[0]+1;break;default:value=value[field[i]]}}htm.Node.src=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":text":var field=attribute.value.split(":");var subject=field;if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject;var scope=zhentu.field.slice()}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){if(!value)return;switch(field[i]){case"#index":var index=scope.length;value=scope[index-1]+1;break;default:value=value[field[i]]}}htm.Node.innerText=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":text|functor":var field=attribute.value.split("|");var subject=field[1].TrimSpace().split(":");field=field[0].TrimSpace().split(":");var functor=Hetui;subject.forEach(function(value,index){functor=functor[value]});subject=field;if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject.slice()}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){if(!value){return};value=value[field[i]]}value=functor.call(htm.Node,htm,observer,value);htm.Node.innerText=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":value":var field=attribute.value.split(":");var subject=field;signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){value=value[field[i]]}htm.Node.value=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":value|name":htm.Node.name=attribute.value;var field=attribute.value.split(":");var subject=field;signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){value=value[field[i]]}htm.Node.value=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":data":var space=attribute.value.split("|");for(var i=0;i<space.length;i++){var field=space[i].trim().split(":");var subject=field;var dataname=["data",...field].join("-");if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field","dataname"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;case"dataname":this[index]=dataname;break;default:}},argument);signal.Functor=function(htm,field,dataname){var value=this;for(var i=0;i<field.length;i++){if(!value)return;value=value[field[i]]}Attribute.Update(htm.Node,dataname,value)};watcher.subscribe(subject,signal);signal.Functor.call(observer,htm,field,dataname)}Attribute.Remove(htm.Node,attribute.name);break;case":title":var field=attribute.value.split(":");var subject=field;if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject;var scope=zhentu.field.slice()}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){if(!value)return;switch(field[i]){case"#index":value=scope[0]+1;break;default:value=value[field[i]]}}Attribute.Update(htm.Node,"title",value)};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case":class":var field=attribute.value.split("?");var data;if(field!=attribute.value){data=field[1].TrimSpace()}field=field[0].split("|");var classname=field[1].TrimSpace();field=field[0].split(":");var subject=field;signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field","classname","data"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;case"classname":this[index]=classname;break;case"data":this[index]=data;break;default:}},argument);signal.Functor=function(htm,field,classname,data){var value=this;for(var i=0;i<field.length;i++){value=value[field[i]]}if(typeof value==="boolean"&&!data){htm.Node.classList.add(classname)}else{var refer=Attribute.Query(htm.Node,data)if(value==refer){htm.Node.classList.add(classname)}else{htm.Node.classList.remove(classname)}}};watcher.subscribe(subject,signal);signal.Functor.call(observer,htm,field,classname,data);break case"#hide":htm.Node.style.display="none";Attribute.Remove(htm.Node,"#hide");hetui[attribute.value]=function(boolean){if(boolean){htm.Node.style.display="none"}else{htm.Node.style.display="initial"}};signal[attribute.name]={Name:attribute.value,Param:Class.Functor.Param(hetui[attribute.value]),Functor:hetui[attribute.value],};signal[attribute.name].Param=new Tuple(signal[attribute.name].Param);hetui[attribute.value]["#hide"]=true;break;case":style|width":var field=attribute.value.split(":");var subject=field;signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){value=value[field[i]]}htm.Node.style.width=value};watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field);break;case"::symbol":switch(attribute.value){case"continue":var index=zhentu.field.length;zhentu.field[index-1]++;break;default:}break;case"foreach:":var range=new Array(3);var subject=attribute.value.split(":");var field=subject.slice();range[0]=htm.Node.parentElement;range[1]=htm.Node.nextSibling;range[2]=htm.Node.previousSibling;if(zhentu.range[0]){field=zhentu.field.concat(subject);subject=zhentu.subject.slice()}else{}Attribute.Update(htm.Node,"::symbol","continue");var child=htm.Node.cloneNode(true);var reference=htm.Node.nextSibling;Attribute.Remove(child,attribute.name);signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;default:}},argument);signal.Functor=function(htm,field){var value=this;for(var i=0;i<field.length;i++){value=value[field[i]];if(!value)break}range.tuple=zhentu.range;subject.tuple=zhentu.subject;zhentu.subject=subject;zhentu.range=range;var store=field.concat(0);store.tuple=zhentu.field;zhentu.field=store;var size=htm.container.length;if(value&&value.length){if(size>value.length){for(i=value.length;i<size;){size=size-1;var node=htm.container[size];zhentu.range[0].removeChild(node);htm.container.pop()}}else{for(i=size;i<value.length;i++){var node=htm.Node;var parent=node.parentElement;node=child.cloneNode(true);Attribute.Remove(node,attribute.name);parent.insertBefore(node,reference);htm.container.push(node);NodeDFS(new HtmNode(node))}var index=zhentu.field.length-1;zhentu.field[index]=0}}else{}};watcher.subscribe(subject,signal);htm.container=new Array(htm.Node);signal.Functor.call(observer,htm,field);break;default:var key=attribute.name;if(key[0]==key[key.length-1]&&key[0]=="_"){key=key.slice(1,-1);var space=attribute.value.split("|");if(space.length!=2){console.error("Hetui Error: 数据转换格式错误",attribute)}var field=space[0].trim().split(":");var subject=field;var arg=space[1].trim();var functor=key.split("-").reduce((obj,k)=>obj&&obj[k],Hetui);if(zhentu.range[0]){field=zhentu.field.concat(field);subject=zhentu.subject}signal[attribute.name]={Name:attribute.value,Param:new Tuple(["htm","field","arg","functor"]),Functor:undefined,};signal=signal[attribute.name];var argument=signal.Param.tuple;signal.Param.Foreach(function(value,index){switch(value){case"htm":this[index]=htm;break;case"field":this[index]=field;break;case"arg":this[index]=arg;break;case"functor":this[index]=functor;break;default:}},argument);signal.Functor=function(htm,field,arg){}watcher.subscribe(subject,signal);Attribute.Remove(htm.Node,attribute.name);signal.Functor.call(observer,htm,field,arg,functor)}}},htm)}break;default:}var tuple=HtmNode.Children(htm.Node);tuple.HtmNode();for(var i=0;i<tuple.length;i++){if(tuple[i].Node==zhentu.range[1]){zhentu.field=zhentu.field.tuple;zhentu.subject=zhentu.subject.tuple;zhentu.range=zhentu.range.tuple}if(tuple[i].Type==2){NodeDFS(tuple[i])}}};NodeDFS(htm)};
